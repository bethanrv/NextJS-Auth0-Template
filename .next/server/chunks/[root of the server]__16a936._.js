module.exports = {

"[externals]/ [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-route.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("@opentelemetry/api");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/compiled/next-server/app-page.runtime.dev.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-unit-async-storage.external.js");

module.exports = mod;
}}),
"[externals]/ [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("next/dist/server/app-render/work-async-storage.external.js");

module.exports = mod;
}}),
"[externals]/ [external] (stream, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("stream");

module.exports = mod;
}}),
"[externals]/ [external] (http, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("http");

module.exports = mod;
}}),
"[externals]/ [external] (url, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("url");

module.exports = mod;
}}),
"[externals]/ [external] (punycode, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("punycode");

module.exports = mod;
}}),
"[externals]/ [external] (https, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("https");

module.exports = mod;
}}),
"[externals]/ [external] (zlib, cjs)": (function(__turbopack_context__) {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, m: module, e: exports, t: require } = __turbopack_context__;
{
const mod = __turbopack_external_require__("zlib");

module.exports = mod;
}}),
"[project]/utils/supabase/server.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "createClient": (()=>createClient)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_import__("[project]/node_modules/@supabase/ssr/dist/module/index.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/headers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/@supabase/ssr/dist/module/createServerClient.js [app-route] (ecmascript)");
;
;
const createClient = async ()=>{
    const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])() // Add await here
    ;
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createServerClient"])(("TURBOPACK compile-time value", "https://zflhetvejevwycmmctrg.supabase.co"), ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmbGhldHZlamV2d3ljbW1jdHJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA4NzM2MTMsImV4cCI6MjA1NjQ0OTYxM30.ppUvKQx2WF--NeQPGaIiX5LfN4N8BKvB0EbiA6PCAtI"), {
        cookies: {
            get (name) {
                return cookieStore.get(name)?.value;
            },
            set (name, value, options) {
                cookieStore.set({
                    name,
                    value,
                    ...options
                });
            },
            remove (name, options) {
                cookieStore.set({
                    name,
                    value: '',
                    ...options
                });
            }
        }
    });
};
}}),
"[project]/app/api/cron-write/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, x: __turbopack_external_require__, y: __turbopack_external_import__, z: require } = __turbopack_context__;
{
__turbopack_esm__({
    "GET": (()=>GET),
    "dynamic": (()=>dynamic)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$utils$2f$supabase$2f$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/utils/supabase/server.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_import__("[project]/node_modules/next/server.js [app-route] (ecmascript)");
;
;
const preferedMarket = 'DraftKings';
async function GET(request) {
    // Authorization check first
    const authHeader = request.headers.get('Authorization');
    if (!authHeader || authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
        return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"]('Unauthorized', {
            status: 401,
            headers: {
                'WWW-Authenticate': 'Bearer'
            }
        });
    }
    // Request upcoming and completed fights
    async function getFights() {
        try {
            const baseUrl = 'https://api.the-odds-api.com/v4/sports/boxing_boxing/scores';
            const params = new URLSearchParams({
                apiKey: process.env.ODDS_API_KEY ? process.env.ODDS_API_KEY : '',
                regions: 'us',
                daysFrom: '3'
            });
            const response = await fetch(`${baseUrl}?${params}`);
            if (!response.ok) throw new Error(`HTTP error status: ${response.status}`);
            const data = response.json();
            return data;
        } catch (e) {
            console.log('get scores failed: ' + e);
            throw e;
        }
    }
    // get odds from odds api
    async function getOdds() {
        try {
            const baseUrl = 'https://api.the-odds-api.com/v4/sports/boxing_boxing/odds';
            const params = new URLSearchParams({
                apiKey: process.env.ODDS_API_KEY ? process.env.ODDS_API_KEY : '',
                regions: 'us',
                oddsFormat: 'american',
                daysFrom: '3'
            });
            const response = await fetch(`${baseUrl}?${params}`);
            if (!response.ok) throw new Error(`HTTP error status: ${response.status}`);
            const data = response.json();
            return data;
        } catch (e) {
            console.log('get odds failed: ' + e);
            throw e;
        }
    }
    // get scores from odds api
    async function getScores() {
        try {
            const baseUrl = 'https://api.the-odds-api.com/v4/sports/boxing_boxing/scores';
            const params = new URLSearchParams({
                apiKey: process.env.ODDS_API_KEY ? process.env.ODDS_API_KEY : '',
                regions: 'us',
                daysFrom: '3'
            });
            const response = await fetch(`${baseUrl}?${params}`);
            if (!response.ok) throw new Error(`HTTP error status: ${response.status}`);
            const data = response.json();
            return data;
        } catch (e) {
            console.log('getFights failed: ' + e);
            throw e;
        }
    }
    // Check if the database contains the given event
    async function dbContainsEvent(event) {
        const { data, error } = await supabase.from('events').select('*').eq('id', event.id);
        if (error) {
            console.error('dbContainsEvent query error:', error);
            throw error;
        }
        return data && data.length > 0;
    }
    // check if a event is already complete
    async function getEventCompleted(event) {
        // get event complete data
        const { data, error } = await supabase.from('events').select('completed').eq('id', event.id);
        if (error) {
            console.error('getEventCompleted query error:', error);
            throw error;
        }
        return false;
    }
    // check if a bookmarker contains our prefered market
    function hasPreferedMarket(event) {
        console.log('testing has prefered market');
        for (const bookmarker of event.bookmakers){
            if (bookmarker.title == preferedMarket) console.log('found prefered market');
            return true;
        }
        console.log('Warning: prefered market not found');
        return false;
    }
    // get bookmarker from prefered market
    function getPreferedBookmarker(event) {
        console.log('getting prefered bookmarker');
        for (const bookmarker of event.bookmakers){
            if (bookmarker.title == preferedMarket) console.log('found prefered bookmarker, ');
            console.log(bookmarker);
            return bookmarker;
        }
        console.log('Error: bookmarker not found');
        throw new Error("Error getting prefered market: market not found");
    }
    // get price of given outcome for given player
    function getOutcomePrice(name, outcomes) {
        console.log('getting outcome price for: ' + name);
        for (const outcome of outcomes){
            if (outcome.name == name) {
                console.log('found outcome of price: ' + outcome.price);
                console.log(outcome);
                return outcome.price;
            }
        }
        console.log('Warning: outcome not found');
        return 0;
    }
    // get bookmarker price for home team
    function getHomeTeamPrice(event) {
        try {
            console.log('getting home team price for event, ');
            console.log(event);
            if (!event.bookmakers[0].markets[0]) {
                console.log('no markets - return 0');
                return 0;
            }
            if (hasPreferedMarket(event)) {
                console.log('...Using prefered');
                const preferedBookmarker = getPreferedBookmarker(event);
                return getOutcomePrice(event.home_team, preferedBookmarker.markets[0].outcomes);
            } else {
                console.log('...Using first market');
                return getOutcomePrice(event.home_team, event.bookmakers[0].markets[0].outcomes);
            }
        } catch (e) {
            console.log('Error getting home team price: ' + e);
            return 0;
        }
    }
    // get bookmarker price for away team
    function getAwayTeamPrice(event) {
        try {
            if (!event.bookmakers[0].markets[0]) {
                console.log('no markets - return 0');
                return 0;
            }
            if (hasPreferedMarket(event)) {
                const preferedBookmarker = getPreferedBookmarker(event);
                return getOutcomePrice(event.away_team, preferedBookmarker.markets[0].outcomes);
            } else {
                return getOutcomePrice(event.away_team, event.bookmakers[0].markets[0].outcomes);
            }
        } catch (e) {
            console.log('Error getting away team price: ' + e);
            return 0;
        }
    }
    async function insertEvent(event) {
        const homeTeamPrice = getHomeTeamPrice(event);
        const awayTeamPrice = getAwayTeamPrice(event);
        console.log('home team price');
        console.log(homeTeamPrice);
        console.log('away team price');
        console.log(awayTeamPrice);
        const { data, error } = await supabase.from('events').insert({
            id: event.id,
            sport_key: event.sport_key,
            sport_title: event.sport_title,
            commence_time: event.commence_time,
            completed: event.completed,
            home_team: event.home_team,
            away_team: event.away_team,
            scores: null,
            last_updated: null,
            home_team_price: homeTeamPrice,
            awayTeamPrice: awayTeamPrice
        }).select('*').single();
        if (error) {
            console.error('Insert error:', error);
            throw error;
        }
        return data;
    }
    async function updateOdds(event) {
        try {
            if (event.bookmakers.length == 0) return;
            const homeTeamPrice = getHomeTeamPrice(event);
            const awayTeamPrice = getAwayTeamPrice(event);
            console.log('home team price');
            console.log(homeTeamPrice);
            console.log('away team price');
            console.log(awayTeamPrice);
            const { data, error } = await supabase.from('events').update({
                home_team_price: homeTeamPrice,
                away_team_price: awayTeamPrice
            }).eq('id', event.id);
            if (error) throw error;
            return data;
        } catch (error) {
            console.error('Update error:', error);
            return null;
        }
    }
    async function updateEvent(fight) {
        try {
            const { data, error } = await supabase.from('events').update({
                sport_key: fight.sport_key,
                scores: fight.scores,
                completed: fight.completed,
                last_updated: new Date().toISOString()
            }).eq('id', fight.id).select('*').single();
            if (error) throw error;
            return data;
        } catch (error) {
            console.error('Update error:', error);
            return null;
        }
    }
    function combineOddsAndScoreData(oddsData, scoresData) {
        let events = [];
        for (const odds of oddsData){
            let event = odds;
            for (const score of scoresData){
                if (odds.id == score.id) {
                    event.scores = score.scores;
                    event.last_updated = score.last_updated;
                    break;
                }
            }
            events.push(event);
        }
        return events;
    }
    // create or update fight events in db
    // get from /odds
    // insert if new
    async function updateFights() {
        console.log('updating fights');
        const oddsData = await getOdds()// get /odds
        ;
        console.log('oddsData');
        console.log(oddsData.length);
        // some metrics to log...  
        let apiEventCount = oddsData.length;
        let insertedCount = 0;
        let updateCount = 0;
        // for each event, insert new & update completed
        for (const event of oddsData){
            if (!dbContainsEvent(event)) {
                console.log('inserting event');
                const insertRes = await insertEvent(event);
                insertedCount++;
            } else {
                // if( event.completed == "true" && (!await getEventCompleted(event)) ) { 
                //     console.log('updating event')
                //     updateEvent(event)
                //     updateCount++
                // }
                updateOdds(event) // aslo update odds 
                ;
            }
        }
        // monitoring
        console.log('Update Summary:');
        console.log(`API found ${apiEventCount} items`);
        console.log(`Inserted ${insertedCount} new items`);
        console.log(`Updated ${updateCount} completed items`);
    }
    // Proceed with database operations after successful auth
    const supabase = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$utils$2f$supabase$2f$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createClient"])();
    try {
        await updateFights();
        const { data, error } = await supabase.from('testTbl').select('*');
        if (error) throw error;
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            count: data.length,
            results: data
        });
    } catch (err) {
        console.error('Cron job failed:', err.message);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: err.message
        }, {
            status: 500
        });
    }
}
const dynamic = 'force-dynamic';
}}),
"[project]/ (server-utils)": ((__turbopack_context__) => {

var { r: __turbopack_require__, f: __turbopack_module_context__, i: __turbopack_import__, s: __turbopack_esm__, v: __turbopack_export_value__, n: __turbopack_export_namespace__, c: __turbopack_cache__, M: __turbopack_modules__, l: __turbopack_load__, j: __turbopack_dynamic__, P: __turbopack_resolve_absolute_path__, U: __turbopack_relative_url__, R: __turbopack_resolve_module_id_path__, b: __turbopack_worker_blob_url__, g: global, __dirname, t: require } = __turbopack_context__;
{
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__16a936._.js.map